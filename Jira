import org.apache.flink.util.Collector;
import org.json.JSONObject;
import java.util.stream.Collectors;
import java.util.stream.Stream;

@Override
public void flatMap(String input, Collector<String> collector) throws Exception {
    String[] lines = input.split(System.lineSeparator());

    for (String line : lines) {
        String[] arr = line.split(",");

        if (headers == null) {
            headers = arr; // Store the header row for key names
            continue; // Skip processing the header row
        }

        JSONObject obj = new JSONObject();

        for (int i = 0; i < arr.length; i++) {
            String jsonKey = headers[i].trim(); // Convert to title case
            String jsonValue = arr[i].trim().replace("\"", ""); // Remove unnecessary quotes

            // Convert the key to title case
            String formattedKey = Stream.of(jsonKey.split("\\s+"))
                    .map(s -> s.substring(0, 1).toUpperCase() + s.substring(1).toLowerCase())
                    .collect(Collectors.joining(" "));

            obj.put(formattedKey, jsonValue);
        }

        collector.collect(obj.toString());
    }
}