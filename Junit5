@Test
void testPerceivedSeverityNullAndStateValueCleared() throws Exception {
    // Given
    String msg = "{\"alarmIdentity\": \"123456\", \"sourceSystemId\": \"System1\", \"alarmType\": \"Communication\", \"state\": \"Cleared\"}";
    
    when(normalizedMsg.getValueFromNormalizedMsg(any(JsonNode.class), eq("externalAlarmId"))).thenReturn("7890");
    when(normalizedMsg.getValueFromNormalizedMsg(any(JsonNode.class), eq("perceivedSeverity"))).thenReturn(null);
    when(normalizedMsg.getValueFromNormalizedMsg(any(JsonNode.class), eq("State"))).thenReturn("Cleared");
    
    // When
    Alarm alarm = alarmRepository.createAlarm(msg);
    
    // Then
    assertNotNull(alarm);
    assertEquals(-1, alarm.getPerceivedSeverity());
}
