@Test
void testApplyPostingRule() throws Exception {
    // Setup
    Alarm alarm = new Alarm();
    PostingRule rule = new PostingRule();
    HashMap<String, Object> alarmMap = new HashMap<>();
    alarmMap.put("key1", "value1");

    ResponseEntity<String> responseEntity = new ResponseEntity<>("topologyData", HttpStatus.OK);

    JsonNode jsonNode = new ObjectMapper().readTree("{\"topologyObjects\": [{\"key1\": \"value1\"}]}");

    when(ruleLoadingService.getRuleMap()).thenReturn(new HashMap<>());
    when(utils.evaluateExpression(anyString(), anyMap())).thenReturn("componentIdReq");
    when(topoApiClient.fetchTopologyTraversalDetails(any(), any(), anyString())).thenReturn(responseEntity);
    when(AlarmPostingConstants.getObjectMapper().readTree(any(String.class))).thenReturn(jsonNode);
    when(utils.evaluateExpression(anyString(), anyMap())).thenReturn("alarmedObject").thenReturn("alarmedObjectTopoDet");

    // Execute
    Alarm result = postingRuleProcessingService.applyPostingRule(alarm, rule, alarmMap);

    // Verify
    assertNotNull(result);
    assertEquals("componentIdReq", result.getComponentId());
    assertEquals("alarmedObject", result.getAlarmedObject());
    assertEquals("topologyDetails", result.getTopologyDetails());
}
