Here is the updated code for the `queryBasedOnParameter` method in the `CoconutServiceVersion3` class:

```
private String queryBasedOnParameter(Map<String, Object> queryParams) {
    String query = coconutDeviceMSConstants.COCONUT_V3_SITE_QUERY;
    StringJoiner finalQuery = new StringJoiner(" AND ");
    
    if("LOCATION".equalsIgnoreCase((String) queryParams.get("outputControl"))){
        if("%".equalsIgnoreCase((String) queryParams.get("locationCLLI"))){
            finalQuery.add(queryHelper.getQueryDetail("coconutDeviceListSiteNameV3").getQuery());
        }
        if("%".equalsIgnoreCase((String) queryParams.get("siteName"))){
            finalQuery.add(queryHelper.getQueryDetail("coconutDeviceListLocationClliv3").getQuery());
        }
        if (queryParams.containsKey("locationCLLI") && !"%".equalsIgnoreCase((String) queryParams.get("locationCLLI"))) {
            finalQuery.add("site.clli_code = lower('" + queryParams.get("locationCLLI") + "') OR site.clli_code = upper('" + queryParams.get("locationCLLI") + "')");
        }
        if (queryParams.containsKey("siteName") && !"%".equalsIgnoreCase((String) queryParams.get("siteName"))) {
            finalQuery.add("site.site_name = '" + queryParams.get("siteName") + "'");
        }
    }
    
    if (finalQuery.length() > 0) {
        query += " WHERE " + finalQuery.toString();
    }
    
    return query;
}
```

This updated code checks if the `locationCLLI` and `siteName` parameters are present in the `queryParams` map. If they are present, it appends the corresponding conditions to the `finalQuery`. If they are not present, it does not append anything to the `finalQuery`. The resulting `finalQuery` will work even without `locationCLLI` or `siteName`.