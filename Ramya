public class CsvtoJsonConversion implements FlatMapFunction<String, String> {

    private String currentObjectName;
    private JsonObject jsonObject;
    private Collector<String> collector;

    @Override
    public void flatMap(String input, Collector<String> collector) throws Exception {
        this.collector = collector;
        String[] arr = input.split("\t"); // Assuming tab-separated values

        // Check if it's a new object
        if (arr.length > 1 && !arr[1].isEmpty()) {
            // Save the current object
            if (jsonObject != null) {
                collector.collect(jsonObject.toString());
            }

            // Initialize a new object
            currentObjectName = arr[1];
            jsonObject = new JsonObject();
            jsonObject.addProperty("ObjectName", currentObjectName);
        } else if (arr.length > 2 && !arr[2].isEmpty()) {
            // Handle the row with Min, Average, Max, Cumulative Counter Value
            String metricName = arr[2].replaceAll("\\s+", "");
            JsonObject metricObject = new JsonObject();
            metricObject.addProperty("Min", arr[3]);
            metricObject.addProperty("Average", arr[4]);
            metricObject.addProperty("Max", arr[5]);
            metricObject.addProperty("CumulativeCounterValue", arr[6]);

            // Add the metric to the current object
            jsonObject.add(metricName, metricObject);
        }
    }

    public void collectLastObject() {
        // Collect the last object
        if (jsonObject != null) {
            collector.collect(jsonObject.toString());
        }
    }
}

