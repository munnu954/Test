private String queryBasedOnParameter(Map<String, Object> queryParams) {
    StringBuilder finalQuery = new StringBuilder();

    if ("LOCATION".equalsIgnoreCase((String) queryParams.get("outputControl"))) {
        finalQuery.append(coconutDeviceMSConstants.COCONUT_V3_SITE_QUERY);
        
        // Adding LEFT JOIN for gdnm_site
        finalQuery.append(" LEFT JOIN gdnm_site site ON switch.site_id = site.id ");

        // Check for locationCLLI parameter
        if (queryParams.containsKey("locationCLLI")) {
            finalQuery.append(" WHERE site.clli_code = LOWER('").append(queryParams.get("locationCLLI")).append("') ")
                      .append(" OR site.clli_code = UPPER('").append(queryParams.get("locationCLLI")).append("') ");
        }

        // Check for siteName parameter
        if (queryParams.containsKey("siteName")) {
            // If locationCLLI is already in WHERE clause, use AND; otherwise, start a new WHERE clause
            if (finalQuery.toString().contains("WHERE")) {
                finalQuery.append(" AND ");
            } else {
                finalQuery.append(" WHERE ");
            }
            finalQuery.append(" siteName = '").append(queryParams.get("siteName")).append("' ");
        }
    }

    return finalQuery.toString();
}