public HashMap<String, Object> removeNullValuesInJsonAttributes(Map<String, Object> msg) {
    HashMap<String, Object> resultMsg = new HashMap<>(msg);
    try {
        for (Map.Entry<String, Object> iterate : msg.entrySet()) {
            if (checkIfJsonValue(iterate.getValue())) {
                String jsonString = iterate.getValue().toString().trim();
                
                // Ensure proper formatting before parsing
                if (!jsonString.startsWith("{") || !jsonString.endsWith("}")) {
                    continue; // Skip invalid JSON structures
                }
                
                HashMap<String, Object> updatedMsg = removeNullValuesInJsonAttributes(
                    RulesConstants.getObjectMapper().readValue(jsonString, HashMap.class)
                );
                resultMsg.put(iterate.getKey(), updatedMsg);
            } else {
                if (iterate.getValue() == null || iterate.getValue().toString().isEmpty()) {
                    resultMsg.remove(iterate.getKey());
                }
            }
        }
    } catch (Exception e) {
        logger.error("Exception occurred while trying to remove null/empty values from JSON attributes: ", e);
    }
    return resultMsg;
}