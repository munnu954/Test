import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequestMapping("/api/spaceCollectors")
public class SpaceCollectorController {

    @Autowired
    SpaceCollectorService spaceCollectorService;
    
    @Autowired
    AuditService auditService;

    @GetMapping("/checkStatus")
    public ResponseEntity<SpaceCollector> checkStatus(@RequestParam("host") String host) {
        // Check if data is being collected for the specified host
        List<SpaceCollector> spaceCollectors = spaceCollectorService.checkStatus(host);

        if (spaceCollectors.isEmpty()) {
            return new ResponseEntity<>(HttpStatus.NOT_FOUND);
        }

        // Get the last collection and transformation dates
        LocalDateTime[] dates = auditService.findLastCollectionAndTransformationDates(host);
        LocalDateTime lastCollectionDate = dates[0];
        LocalDateTime lastTransformationDate = dates[1];

        // Prepare the output response including the last collection and transformation dates
        SpaceCollector collector = spaceCollectors.get(0); // Assuming the list contains at least one item
        collector.setLastSuccessfulCollection(lastCollectionDate);
        collector.setLastSuccessfulTransformation(lastTransformationDate);

        return new ResponseEntity<>(collector, HttpStatus.OK);
    }
}
