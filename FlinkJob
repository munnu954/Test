
public static class CsvtoJsonMRFCnTransformer extends RichFlatMapFunction {

  private String[] headers;
  private IntCounter successIntCounter = new IntCounter();
  private IntCounter failureIntCounter = new IntCounter();

  @Override
  public void open(Configuration parameters) throws Exception {
    getRuntimeContext().addAccumulator("successIntCounter", this.successIntCounter);
    getRuntimeContext().addAccumulator("failureIntCounter", this.failureIntCounter);
  }

  @Override
  public void flatMap(String s, Collector collector) throws Exception {
    String[] lines = s.split(System.lineSeparator());
    for (int i = 0; i < lines.length; i++) {
      String str = lines[i];
      String[] arr = str.split(",");

      if (i == 0) {
        headers = arr; // Store the header row for key names
        continue; // Skip processing the header row
      }

      if (headers == null || headers.length != arr.length) {
        this.failureIntCounter.add(1);
        continue;
      }

      JSONObject obj = new JSONObject();
      for (int j = 0; j < arr.length; j++) {
        String jsonkey = headers[j].trim().replace("\"", "");
        String jsonvalue = arr[j].trim().replace("\"", "");
        obj.put(jsonkey, jsonvalue);
      }

      collector.collect(obj.toString());
    }
  }
}