import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;

import java.io.File;
import java.io.IOException;
import java.util.Arrays;
import java.util.List;

import static org.junit.Assert.assertEquals;

@RunWith(Parameterized.class)
public class TextToJsonJobTest {

    private static final String INPUT_FILE_PATH = "src/test/resources/input.txt";
    private static final String OUTPUT_FILE_PATH = "src/test/resources/output.json";

    private final String input;
    private final String expectedOutput;

    @Parameterized.Parameters
    public static List data() {
        return Arrays.asList(new Object[][]{
            {"1,2,3", "{\"key1\":1,\"key2\":2,\"key3\":3}"},
            {"4,5,6", "{\"key4\":4,\"key5\":5,\"key6\":6}"},
            {"7,8,9", "{\"key7\":7,\"key8\":8,\"key9\":9}"},
        });
    }

    public TextToJsonJobTest(String input, String expectedOutput) {
        this.input = input;
        this.expectedOutput = expectedOutput;
    }

    @Test
    public void testTextToJsonJob() throws IOException {
        // Arrange
        TextToJsonJob job = new TextToJsonJob();
        job.setInputFilePath(INPUT_FILE_PATH);
        job.setOutputFilePath(OUTPUT_FILE_PATH);

        // Act
        job.run();

        // Assert
        String actualOutput = readFile(OUTPUT_FILE_PATH);
        assertEquals(expectedOutput, actualOutput);
    }

    private String readFile(String filePath) throws IOException {
        StringBuilder builder = new StringBuilder();
        try (
            FileReader reader = new FileReader(filePath);
            BufferedReader bufferedReader = new BufferedReader(reader)
        ) {
            String line;
            while ((line = bufferedReader.readLine()) != null) {
                builder.append(line);
            }
        }
        return builder.toString();
    }
}