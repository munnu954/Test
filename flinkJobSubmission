import org.apache.flink.api.common.functions.FlatMapFunction;
import org.apache.flink.api.java.utils.ParameterTool;
import org.apache.flink.util.Collector;
import org.json.JSONObject;

public class CsvtoJsonTransformer implements FlatMapFunction<String, String> {

    private String[] columnNames;

    public CsvtoJsonTransformer(String[] columnNames) {
        this.columnNames = columnNames;
    }

    @Override
    public void flatMap(String csvRow, Collector<String> out) {
        String[] rowData = csvRow.split(",(?=([^\"]*\"[^\"]*\")*[^\"]*$)", -1);
        JSONObject jsonObject = new JSONObject();

        for (int i = 0; i < columnNames.length && i < rowData.length; i++) {
            String jsonKey = columnNames[i].trim().replace(" ", "");
            String value = rowData[i].trim().replace("\"", ""); // Remove quotes, trim extra spaces
            jsonObject.put(jsonKey, value);
        }

        out.collect(jsonObject.toString());
    }
}