public class CsvtoJsonConversion implements FlatMapFunction<String, String> {

    private String currentObjectName;

    @Override
    public void flatMap(String input, Collector<String> collector) throws Exception {
        String[] arr = input.split(",");
        String columnName = arr[2].trim();  // Assuming the ObjectName is in the third column (index 2)

        if (!columnName.isEmpty()) {
            // New Object
            currentObjectName = columnName;
            JsonObject jsonObject = new JsonObject();
            jsonObject.addProperty("ObjectName", currentObjectName);
            collector.collect(jsonObject.toString());
        } else {
            // Sub-Object
            JsonObject subObject = new JsonObject();
            subObject.addProperty("SubObjectName", arr[0].trim());  // Assuming sub-object name is in the first column (index 0)
            subObject.addProperty("Min", arr[5].trim());
            subObject.addProperty("Average", arr[4].trim());
            subObject.addProperty("Max", arr[3].trim());
            subObject.addProperty("CumulativeCounterValue", arr[6].trim());

            // Add sub-object to the current object
            JsonObject currentObject = new JsonObject();
            currentObject.addProperty("ObjectName", currentObjectName);
            currentObject.add(arr[0].trim(), subObject);

            collector.collect(currentObject.toString());
        }
    }
}

