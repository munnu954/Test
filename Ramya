import com.google.gson.JsonObject;
import org.apache.flink.api.common.functions.FlatMapFunction;
import org.apache.flink.util.Collector;

public class CsvtoJsonConversion implements FlatMapFunction<String, String> {

    @Override
    public void flatMap(String input, Collector<String> collector) throws Exception {
        String[] columns = input.split(",");
        String title = findTitle(columns);

        if (title != null) {
            // Process the row based on the identified title
            String jsonResult = processSection(columns, title);
            collector.collect(jsonResult);
        }
    }

    private String findTitle(String[] columns) {
        for (String column : columns) {
            if (!column.trim().isEmpty()) {
                // Found the first non-empty column, use it as the title
                return column.trim();
            }
        }
        return null;  // No non-empty column found
    }

    private String processSection(String[] columns, String title) {
        JsonObject jsonObject = new JsonObject();
        jsonObject.addProperty("ObjectName", title);

        // Extract and add relevant attributes to the JSON object
        // Customize this part based on your CSV structure
        for (int i = 1; i < columns.length; i++) {
            String jsonKey = "key" + i;
            jsonObject.addProperty(jsonKey, columns[i].trim());
        }

        return jsonObject.toString();
    }
}
