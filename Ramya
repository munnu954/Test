package org.vdsi.space.collections.customauditengine.services;

import org.json.JSONException;
import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.vdsi.space.collections.customauditengine.model.SpaceCollector;
import org.vdsi.space.collections.lucene.SpaceCollectorLuceneRepository;
import org.vdsi.space.collections.customauditengine.utils.Transformer;

import java.util.List;

@Service
public class AuditService {

    @Autowired
    private SpaceCollectorLuceneRepository spaceCollectorLuceneRepository;

    @Autowired
    private Transformer transformer;

    public List<SpaceCollector> checkStatus(String host) throws JSONException {
        // Build the query to fetch COLLECTION_SUCCESSFUL and FLINK_JOB_SUCCESSFUL data
        JSONObject query = transformer.buildAuditQuery();

        // Fetch space collector data based on the host and query
        List<SpaceCollector> spaceCollectors = spaceCollectorLuceneRepository.findByQuery(query.toString());

        return spaceCollectors;
    }
}
