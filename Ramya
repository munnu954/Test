@Override
public void flatMap(String s, Collector<String> collector) throws Exception {
    String[] arr = s.split(",");
    if (headers == null) {
        headers = arr;
        return;
    }

    JsonObject obj = new JsonObject();
    String currentObjectName = arr[2].trim();

    for (int i = 0; i < arr.length; i++) {
        String jsonKey = headers[i].trim();
        String jsonValue = arr[i].trim().replace("\"", "");

        if (jsonKey.equals("ObjectName")) {
            currentObjectName = jsonValue;
            continue;
        }

        if (jsonValue.equals("") || jsonKey.equals("")) {
            continue;  // Skip empty values and keys
        }

        if (jsonKey.equals("BEGIN DATE") || jsonKey.equals("END DATE") || jsonKey.equals("TICKET NUMBER")) {
            obj.addProperty(jsonKey, jsonValue);
        } else {
            JsonObject metricsObj = new JsonObject();
            metricsObj.addProperty("Min", arr[i + 1].trim());
            metricsObj.addProperty("Average", arr[i + 2].trim());
            metricsObj.addProperty("Max", arr[i + 3].trim());
            metricsObj.addProperty("Cumulative Counter Value", arr[i + 4].trim());
            obj.add(jsonKey, metricsObj);
            i += 4;  // Skip the metrics columns
        }
    }

    String jsonOutput = obj.toString();
    collector.collect(jsonOutput);
}
