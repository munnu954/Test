AI ðŸ¤–:
Feature: Polling Service

As a developer, I want to be able to poll the device database for new records.

So that I can process them in a timely manner.

Scenario: One thread created for one space collector record present in repo

Given: One record in space collector repository

When the scheduler runs

Then the poller should create 1 thread

And validate that one thread is created and it is running

Steps:

1. Given a space collector repository with one record.
2. When the scheduler runs.
3. Then the poller should create one thread.
4. And validate that one thread is created and it is running.


@Given("a space collector repository with one record")
public void givenASpaceCollectorRepositoryWithOneRecord() {
  // Arrange
  SpaceCollectorRepository spaceCollectorRepository = new SpaceCollectorRepository();
  SpaceCollector spaceCollector = new SpaceCollector();
  spaceCollector.setId("1");
  spaceCollector.setEnabled(true);
  spaceCollectorRepository.save(spaceCollector);
}

@When("the scheduler runs")
public void whenTheSchedulerRuns() {
  // Act
  PollingServiceImpl pollingService = new PollingServiceImpl();
  pollingService.pollDeviceDB();
}

@Then("the poller should create one thread")
public void thenThePollerShouldCreateOneThread() {
  // Assert
  assertThat(pollingService.getActiveThreadCount()).isEqualTo(1);
}

@And("validate that one thread is created and it is running")
public void andValidateThatOneThreadIsCreatedAndItIsRunning() {
  // Assert
  assertThat(pollingService.getRunningThreads()).hasSize(1);
}