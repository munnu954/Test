Feature: Nested Files Validation

  Scenario Outline: Retrieve and validate nested files from remote server
    Given a SpaceCollector with the following details
      | username | url     | password | port | inputFilePath  | outputFilePath |
      | user     | host    | pass     | 22   | /remote/path   | /local/path    |
    And the current date is "2023-01-01"
    And the audit topic is "audit-topic"
    And the remote directory "/remote/path" contains the following files
      | filename   | isDir |
      | Sample.zip | false |
    And the nested directory "/local/path/Sample" contains the following files
      | filename       | isDir |
      | nestedFile.txt | false |
    And the ZIP file "/local/path/Sample.zip" contains the following files
      | filename       |
      | nestedFile.txt |
    When the data retriever retrieves data
    Then the following local files should be created
      | filename                |
      | /local/path/Sample.zip  |
      | /local/path/Sample/nested/nestedFile.txt |
    And the following messages should be sent to Kafka
      | key                                  | status             |
      | Sample.zip                           | COLLECTION_SUCCESS |
      | Sample/nested/nestedFile.txt         | COLLECTION_SUCCESS |
