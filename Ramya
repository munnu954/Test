import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import java.time.LocalDateTime;

@Service
public class AuditService {

    @Autowired
    private CollectionAuditRepository auditRepository;

    public CollectionAuditInfo getLastSuccessfulDates(String url) {
        CollectionAuditInfo auditInfo = new CollectionAuditInfo();

        try {
            LocalDateTime lastCollectionDate = auditRepository.findFirstByUrlAndStatusOrderByDateProcessedDesc(url, "COLLECTION_SUCCESSFUL");
            auditInfo.setLastSuccessfulCollection(lastCollectionDate);

            LocalDateTime lastTransformationDate = auditRepository.findFirstByUrlAndStatusOrderByDateProcessedDesc(url, "FLINK_JOB_SUCCESSFUL");
            auditInfo.setLastSuccessfulTransformation(lastTransformationDate);
        } catch (Exception e) {
            e.printStackTrace();
            // Handle exceptions as needed
        }

        return auditInfo;
    }
}
