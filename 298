import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class AlarmPostingUtilsTest {

    private Map<String, Object> srcMap;
    private String ruleName;

    @BeforeEach
    public void setup() {
        srcMap = new HashMap<>();
        srcMap.put("attribute1", "value1");
        srcMap.put("attribute2", "value2");

        Map<String, Object> nestedMap = new HashMap<>();
        nestedMap.put("attribute4", "value4");
        srcMap.put("attribute2", nestedMap);

        List<String> attributeList = new ArrayList<>();
        attributeList.add("value5");
        attributeList.add("value6");
        srcMap.put("attribute5", attributeList);

        ruleName = "rule1";
    }

    @Test
    public void testParse_WhenValueContainsNoMatches_ShouldReturnOriginalValue() {
        String value = "No matches";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals(value, result);
    }

    @Test
    public void testParse_WhenValueContainsMatchWithNoAttribute_ShouldReturnEmptyString() {
        String value = "%attribute3%";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals("", result);
    }

    @Test
    public void testParse_WhenValueContainsMatchWithExistingAttribute_ShouldReturnAttributeValue() {
        String value = "%attribute1%";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals("value1", result);
    }

    @Test
    public void testParse_WhenValueContainsMatchWithNestedAttribute_ShouldReturnNestedAttributeValue() {
        String value = "%attribute2.attribute4%";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals("value4", result);
    }

    @Test
    public void testParse_WhenValueContainsMatchWithArrayIndex_ShouldReturnArrayElementValue() {
        String value = "%attribute5[1]%";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals("value6", result);
    }

    @Test
    public void testParse_WhenValueContainsMatchWithInvalidArrayIndex_ShouldReturnEmptyString() {
        String value = "%attribute5[-1]%";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals("", result);
    }

    @Test
    public void testParse_WhenValueContainsMatchWithNonexistentArray_ShouldReturnEmptyString() {
        String value = "%attribute6[0]%";
        String result = AlarmPostingUtils.parse(value, srcMap, ruleName);
        Assertions.assertEquals("", result);
    }

}