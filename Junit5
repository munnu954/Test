import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

import org.junit.jupiter.api.Test;

import java.lang.reflect.Field;

class PulsarSslConfigurationTest {

    @Test
    void testPulsarClientPemSslCustomizer() throws NoSuchFieldException, IllegalAccessException {
        PulsarSslConfiguration configuration = new PulsarSslConfiguration();
        Field certificatesLocField = configuration.getClass().getDeclaredField("certificatesLoc");
        certificatesLocField.setAccessible(true);
        certificatesLocField.set(configuration, "test");

        PulsarClientBuilderClient pulsarClientBuilder = mock(PulsarClientBuilderClient.class);
        configuration.pulsarClientPemSslCustomizer().accept(pulsarClientBuilder);

        verify(pulsarClientBuilder).allowTlsInsecureConnection(false);
        verify(pulsarClientBuilder).enableTlsHostnameVerification(false);
        verify(pulsarClientBuilder).authentication(AuthenticationFactory.TLS("test/jpsv.cert.pem", "test/jpsv.key-pk8.pem"));
        verify(pulsarClientBuilder).tlsTrustCertsFilePath("test/ca.cert.pem");
        verify(pulsarClientBuilder).tlsKeyFilePath("test/jpsv.key-pk8.pem");
        verify(pulsarClientBuilder).tlsCertificateFilePath("test/jpsv.cert.pem");
    }
}