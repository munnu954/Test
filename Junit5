import org.junit.Before;
import org.junit.Test;
import org.junit.Assert;

import java.util.ArrayList;
import java.util.List;

public class XmlToJsonConverterTest {

    private XmlToJsonConverter xmlToJsonConverter;

    @Before
    public void setUp() {
        String primaryKey = "measInfo";
        String filePath = "src/test/resources/files/ETAS.xml";
        String fileName = "ETAS.xml";
        xmlToJsonConverter = new XmlToJsonConverter(primaryKey, filePath, fileName);
    }

    @Test
    public void testXmlToJsonConversion() throws Exception {
        String testXml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>" +
                "<measInfo>" +
                "<measValue>" +
                "<duration>PT900S1</duration>" +
                "<elementType>PCC100</elementType>" +
                "</measValue>" +
                "</measInfo>" +
                "<measInfo>" +
                "<measValue>" +
                "<duration>PT90052</duration>" +
                "<elementType>PCC200</elementType>" +
                "</measValue>" +
                "</measInfo>" +
                "<measInfo>" +
                "<measValue>" +
                "<duration>PT900S3</duration>" +
                "<elementType>PCC150</elementType>" +
                "</measValue>" +
                "</measInfo>"; // Provide sample XML content

        TestCollector<String> collector = new TestCollector<>();
        xmlToJsonConverter.flatMap(testXml, collector);

        int successCount = collector.getCollected().size();
        int failureCount = xmlToJsonConverter.getFailureCount();

        Assert.assertEquals(3, successCount);
        Assert.assertEquals(0, failureCount);
    }

    class TestCollector<T> implements Collector<T> {
        private List<T> collected = new ArrayList<>();

        @Override
        public void collect(T record) {
            collected.add(record);
        }

        @Override
       public void close() {}

        public List<T> getCollected() {
            return collected;
        }
    }
}