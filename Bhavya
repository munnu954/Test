AI ðŸ¤–:
Feature: Polling Service

As a developer, I want to be able to poll the device database for changes.

So that I can be notified of any changes and take action accordingly.

Scenario: One thread created for one space collector record present in repo

Given: One record in space collector repository

When the scheduler runs

Then the poller should create 1 thread

And validate that one thread is created and it is running

Steps:

1. Given a space collector repository with one record
2. When the scheduler runs
3. Then the poller should create one thread
4. And validate that one thread is created and it is running

Given


@Given("a space collector repository with one record")
public void givenASpaceCollectorRepositoryWithOneRecord() {
    // Arrange
    SpaceCollectorRepository spaceCollectorRepository = new SpaceCollectorRepository();
    SpaceCollector spaceCollector = new SpaceCollector();
    spaceCollector.setId(1);
    spaceCollector.setEnabled(true);
    spaceCollectorRepository.save(spaceCollector);
}


When


@When("the scheduler runs")
public void whenTheSchedulerRuns() {
    // Act
    PollingServiceImpl pollingService = new PollingServiceImpl();
    pollingService.pollDeviceDB();
}


Then


@Then("the poller should create one thread")
public void thenThePollerShouldCreateOneThread() {
    // Assert
    assertThat(pollingService.getActiveThreadCount()).isEqualTo(1);
}

@Then("and validate that one thread is created and it is running")
public void andValidateThatOneThreadIsCreatedAndItIsRunning() {
    // Assert
    Thread thread = pollingService.getActiveThreads().get(0);
    assertThat(thread.getState()).isEqualTo(Thread.State.RUNNABLE);
}