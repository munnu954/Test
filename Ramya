import org.apache.flink.api.common.functions.FlatMapFunction;
import org.apache.flink.util.Collector;

import com.google.gson.JsonObject;

public class CsvtoJsonTonesTransformer implements FlatMapFunction<String, String> {

    @Override
    public void flatMap(String input, Collector<String> collector) throws Exception {
        String[] rows = input.split(";");

        if (rows.length < 11) {
            // Invalid row, skip processing
            System.out.println("Invalid row: " + input);
            return;
        }

        JsonObject json = new JsonObject();

        json.addProperty("ObjectName", rows[2].trim());

        for (int i = 3; i < rows.length; i++) {
            String[] entry = rows[i].split(";");
            if (entry.length >= 2) {
                String key = entry[0].trim();
                String value = entry[1].trim();
                json.addProperty(key, value);
            }
        }

        String result = json.toString();
        System.out.println("Transformed JSON: " + result);
        collector.collect(result);
    }
}
